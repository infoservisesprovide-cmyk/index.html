<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Email & Phone Extractor</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
    <div class="max-w-xl mx-auto bg-white p-6 rounded shadow">
        <h1 class="text-2xl font-bold mb-4 text-center">Email & Phone Extractor</h1>


        <textarea id="urls" class="w-full h-32 border p-2 rounded" placeholder="Enter URLs, one per line (only contact page URLs will be extracted)"></textarea>


        <button id="extractBtn" class="mt-4 w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600">Extract</button>


        <div class="flex justify-between mt-2">
            <button id="copyBtn" class="bg-green-500 text-white p-2 rounded hover:bg-green-600">Copy Results</button>
            <button id="downloadBtn" class="bg-purple-500 text-white p-2 rounded hover:bg-purple-600">Download TXT</button>
        </div>


        <div id="results" class="mt-4"></div>
    </div>


    <script>
        let finalResults = [];


        document.getElementById('extractBtn').addEventListener('click', async () => {
            const urls = document.getElementById('urls').value.split('\n').filter(u => u);
            if(urls.length === 0) return alert("Enter at least one URL");


            const resDiv = document.getElementById('results');
            resDiv.innerHTML = "Processing...";


            try {
                const response = await fetch('http://localhost:5000/extract', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ urls })
                });
                const data = await response.json();
                finalResults = [];


                resDiv.innerHTML = "";
                data.forEach(item => {
                    const urlBlock = document.createElement('div');
                    urlBlock.className = "mb-4 p-2 border rounded bg-gray-50";


                    const emails = item.emails ? [...new Set(item.emails)] : [];
                    const phones = item.phones ? [...new Set(item.phones)] : [];


                    finalResults.push(`URL: ${item.url}\nEmails: ${emails.join(', ')}\nPhones: ${phones.join(', ')}\n`);


                    urlBlock.innerHTML = `
                        <strong>URL:</strong> ${item.url}<br>
                        <strong>Emails:</strong> ${emails.join(', ') || 'None'}<br>
                        <strong>Phones:</strong> ${phones.join(', ') || 'None'}
                    `;
                    resDiv.appendChild(urlBlock);
                });
            } catch (err) {
                resDiv.innerHTML = "Error fetching data";
            }
        });


        document.getElementById('copyBtn').addEventListener('click', () => {
            if(finalResults.length === 0) return alert("No results to copy");
            navigator.clipboard.writeText(finalResults.join('\n\n'));
            alert("Results copied to clipboard!");
        });


        document.getElementById('downloadBtn').addEventListener('click', () => {
            if(finalResults.length === 0) return alert("No results to download");
            const blob = new Blob([finalResults.join('\n\n')], { type: 'text/plain' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'results.txt';
            a.click();
        });
    </script>
</body>
</html>